# High-Performance Computing final project "Game of Life"

### Introduction
- This is the code for the Final Project for the class High-Performance Computing

- Be noted that this version of Game of Life use a 1D-Vector as a map to gain some performance, for this the loading of a map from a file follows its own format. Each file should start as follows:
1. First line must be the height and width separated by a space ```h w```
2. Each subsequent line represent the state of a cell in numerical order from the state of the cell at index 0 to N. This values should be either 1 or 0. To ensure that each cell state is loaded the amount of lines in the document should be $$width\cdot height + 1$$ otherwise there are less states than cells. Each cell with no assigned state will be assign 0.

## Running the program
- This project contains a CMake file, to execute the code follow these steps
1. ```cd build```
2. ```cmake ..```
3. ```make run```

    To erase all files generated by CMake please execute `make clean-all`  

### Useful Information
- This version of Game of Life use a 1D-Vector as a map to gain some performance, for this the loading of a map from a file follows its own format. Each file should start as follows:
    1. First line must be the height and width separated by a space ```h w```.
    2. Each subsequent line represent the state of a cell in numerical order from the state of the cell at index 0 to N. This values should be either 1 or 0. To ensure that each cell state is loaded the amount of lines in the document should be $$width\cdot height + 1$$ otherwise there are less states than cells. Each cell with no assigned state will be assign 0.

- As the sizes for the map in the task are all representable in the form of $10^x\,|\,x\in\mathbb{N}_{\geq0}$ I've decided to set the `local_group_size` to $10$. To run the application using **OpenCL** must apply that $$width\mod10 == 0 \text{ and } height\mod 10 == 0$$

# Excercise 1.F
- The function ```evolve()``` was modified to work using OpenCL translating the previous version into a kernel compatible one now called `evolve_opencl()`.

- The function ```print()``` stays the same as before it does not run parallel as to make it work we would have to limit the parallelization using mutex, locks or ```omp critical```, which technically is very similar as doing it in the "scalar" way.


- The function `randomize()` add diferent figures between the available ones (those being the requested ones in the task)

![](./img/beacon.png)
*This is the Beacon figure*

![](./img/Toad.png)
*This is the Toad figure*  

![](./img/glider.png)
*This is the Glider figure*

![](./img/methuselah_r-pentonimo.png)
*This is the Methuselah figure using the R-Pentonimo version*

It add figures at random until $H(map) \geq 0.7$ to ensure that the map is not over- or under- populated. It does this adding over $10000$ iterations. The minimal entropy value can be change and the amount of iterations can also be change when passed as arguments to the function. This function is also available in parallel as `randomize1()` using **OpenMP**.

To avoid taking too much time while making the calculations for the entropy the sub-function is also parallelized.

- For further optimization I also parellelized the `is_stable()` function, which test if the system is stable and the simulation should be stopped. This function checks back up to two generations to see if the world is stable, meaning that in cases where we only have _Toads_ the simulation would stop within the $3^{\text{rd}}$ generation. The improve version is called `compare_cl()`

- The menu for populating gives 4 options
    - 0 or no population
    - 1 _sca-easy_ just random normal distribution of 1 and 0.
    - 2 _sca-hard_ a entropy based adding figured method.
    - 3 _OpenMP_ a double parallelized, entropy based, adding figure method \*\*

_**Please cheack Extras_
# Excercise 2.F

- There is not much to say here as the functionality was the same as in task 2. Functionality was imported to work with the new function parameters and class architecture.

- Instead of `run_world()` (option 7) giving the amount of time we have an option `present_data()` (option 11), which displays the amount of time that each evolution cycle took to excecute (evolve and compare is 1 cycle) and display the total time in the end. 
# Testing

Please be noted that the calculated run-time for the OpenCL version does not consider the set up time but it does include the time needed for creation of buffers and set-up of kernel `args...`

![](./img/simple_plot.png)

![](./img/avg_plot.png)

# Known Issues
1. When pressing anything before creating the world from the menu or loading from it it causes the programm to crash.
    - No idea for the reason and the debugger didnt say anything... To AVOID this just follow the logical steps of creating the world then running simulation and at last present data.

2. Present data before anything else causes to print a very large array of 0... and segmentation fault PLS dont do it... makes no sense to do this before having data.

3. Pressing 0 directly after starting the program causes a segmentation-fault
    - NO IDEA WHY

Most of this issues come from the `nullptr` assertion not really working.
A logical use of the program should avoid any unexpected behavior.
## Extras

- The path for the files of the maps is usually `../resources/<name>.txt`

- Due to decision mistakes the `randomize1()` is run using OpenMP, which is good but it runs on the CPU and for big maps/worlds is not good enough and takes a long time including that it _sub-parallelize_ the work with another function. This causes **HUGE** overhead going from aprox. 15 minutes to populate using `randomize()` to more than 1.5 hours using `randomize1()`.

    To populate big maps we will use `simple_randomize()` (option 1 in populate menu _"sca-easy"_), which change the state of the cell following a random normal distribution.

- In the `./resources/` folder there are 2 world maps store that could work as a _"demo"_, those where populated using _sca-hard_ and they are called `1000world.txt` and `10000world.txt`. All test were made on this maps to ensure fair comparison; lower level comparison was made in random maps.